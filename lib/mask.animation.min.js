(function(t,n){"use strict";null==t&&"undefined"!=typeof global&&(t=global);var i=function(){return n(t,t.mask)};if("object"==typeof exports)module.exports=i();else if("function"==typeof define&&define.amd)define(i);else{var e=i();for(var r in e)t.mask[r]=e[r]}})(this,function(t,n){"use strict";var i=document.createElement("div"),e=function(){return"transform"in i.style?"":"webkitTransform"in i.style?"webkit":"MozTransform"in i.style?"Moz":"OTransform"in i.style?"O":"msTransform"in i.style?"ms":""}(),r=e?"-"+e.toLowerCase()+"-":"",o=function(){var t=document.createElement("div"),n={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},i=null;for(var e in n)if(void 0!==t.style[e]){i=n[e];break}return o=function(){return i},t=null,n=null,o()},s={prop:r+"transition-property",duration:r+"transition-duration",timing:r+"transition-timing-function",delay:r+"transition-delay"},a=function(){function t(t){var n=null;for(e.lastIndex=0;;){var i=e.exec(t);if(!i)return n;(n||(n={}))[i[1]]=i[0]}}function n(t){for(var n=Object.keys(t).sort().reverse(),i=0;n.length>i;i++)n[i]=t[n[i]];return n.join(" ")}function i(){this.transforms={}}var e=/([\w]+)\([^\)]+\)/g;return i.prototype={constructor:i,handle:function(i){var e=t(i.from),r=t(i.to),o=null;if(e){for(o in this.transforms)o in e==!1&&(e[o]=this.transforms[o]);i.from=n(e);for(o in e)this.transforms[o]=e[o]}for(o in this.transforms)o in r==!1&&(r[o]=this.transforms[o]);i.to=n(r);for(o in r)this.transforms[o]=r[o]}},i}(),l=function(){function t(t){var n=t.split(/ *\| */g),i={},o=n.length;i.prop=n[0]in e?r+n[0]:n[0];var s=n[1].split(/ *> */);if(s[0]&&(i.from=s[0]),i.to=s[s.length-1],o>2){var a=/(\d+m?s)?\s*([a-z]+[^\s]*)?\s*(\d+m?s)?/.exec(n[2]);if(null!=a)return i.duration=a[1]||"200ms",i.timing=a[2]||"linear",i.delay=a[3]||"0",i}return i.duration="200ms",i.timing="linear",i.delay="0",i}function n(i,e){this.parent=e,this.transformModel=e&&e.transformModel||new a;var r=i.model||i;if(r instanceof Array){this.model=[];for(var o=0,s=r.length;s>o;o++)this.model.push(new n(r[o],this))}else if(r instanceof Object){if(r===i)return console.error('Animation Object Model has no "model" property',i),this.modelCount=this.nextCount=this.state=0,void 0;this.model=[new n(r,this)]}else"string"==typeof r&&(this.model=t(r),~this.model.prop.indexOf("transform")&&this.transformModel.handle(this.model));null!=i.next&&(this.next=new n(i.next,this)),this.state=0,this.modelCount=this.model instanceof Array?this.model.length:1,this.nextCount=0,null!=this.next&&(this.nextCount=this.next instanceof Array?this.next.length:1)}function i(t){for(var n=t instanceof Array,i=n?t.length:1,e=null,r=0;n?i>r:1>r;r++)e=n?t[r]:t,e.reset&&e.reset()}var e={transform:null};return n.prototype={constructor:n,reset:function(){this.state=0,this.modelCount=this.model instanceof Array?this.model.length:1,this.nextCount=0,null!=this.next&&(this.nextCount=this.next instanceof Array?this.next.length:1),this.model&&i(this.model),this.next&&i(this.next)},getNext:function(){return 0===this.state?(this.state=1,this):(1===this.state&&this.modelCount>0&&--this.modelCount,1===this.state&&0===this.modelCount&&(this.state=2,this.next)?this.next:(2===this.state&&this.nextCount>0&&--this.nextCount,2===this.state&&0===this.nextCount&&this.parent?this.parent.getNext&&this.parent.getNext():null))}},n}(),u=function(){function t(){this.arr=[]}return t.prototype={constructor:t,put:function(t){if(null==t)return!1;var n,i,e=t.getNext(),r=!1;if(null==e)return!1;if(e instanceof Array){for(i=0,n=e.length;n>i;i++)this.put(e[i])===!0&&(r=!0);return r}if(0===e.state&&(e.state=1),e.model instanceof Array){for(r=!1,i=0,n=e.model.length;n>i;i++)this.put(e.model[i])===!0&&(r=!0);return r}return this.resolve(e.model.prop),this.arr.push(e),!0},resolve:function(t){for(var n,i=0,e=this.arr.length;e>i;i++)if(n=this.arr[i],n.model.prop===t)return this.arr.splice(i,1),this.put(n);return!1},getCss:function(t,n){var i,e,r,o;for(i=0,e=this.arr.length;e>i;i++){o=this.arr[i],"from"in o.model&&(t[o.model.prop]=o.model.from),n[o.model.prop]=o.model.to;for(r in s)(n[s[r]]||(n[s[r]]=[])).push(o.model[r])}for(r in s)n[s[r]]=n[s[r]].join(",")},clear:function(){this.arr=[]}},t}(),f=function(){function t(t){this.stack=new u,this.model=new l(t),this.transitionEnd=this.transitionEnd.bind(this)}var n=window.WebKitTransitionEvent||window.mozTransitionEvent||window.oTransitionEvent||window.TransitionEvent,i={display:1,"font-family":1,visibility:1};return"object"==typeof n&&(n=function(t,n){var i=document.createEvent("WebKitTransitionEvent");return i.initWebKitTransitionEvent("webkitTransitionEnd",!0,!0,n.propertyName,0),i}),t.prototype={constructor:t,start:function(t,n){this.onComplete=n;var i={},e={};this.model.reset(),this.stack.clear(),this.stack.put(this.model),this.stack.getCss(i,e),t.addEventListener(o(),this.transitionEnd,!1),this.element=t,this.apply(i,e)},transitionEnd:function(t){if(this.stack.resolve(t.propertyName)===!0){var n={},i={};this.stack.getCss(n,i),this.apply(n,i)}else 1>this.stack.arr.length&&(this.element.removeEventListener(o(),this.transitionEnd,!1),this.onComplete&&this.onComplete())},apply:function(t,e){t[r+"transition"]="none";var s=this.element.style,a=this.element;if(null!=t)for(var l in t)s.setProperty(l,t[l],"");setTimeout(function(){var t;for(var r in e)s.setProperty(r,e[r],""),i.hasOwnProperty(r)&&(t||(t=[])).push(r);if(null!=t&&null!=n)for(var l=o(),u=0;t.length>u;u++){var f=new n(l,{propertyName:t[u],bubbles:!0,cancelable:!0});a.dispatchEvent(f)}},0)}},t}(),m=function(){var t={},n=null,i=function(){n={keyframes:"@"+r+"keyframes",AnimationIterationCount:e+"AnimationIterationCount",AnimationDuration:e+"AnimationDuration",AnimationTimingFunction:e+"AnimationTimingFunction",AnimationFillMode:e+"AnimationFillMode",AnimationName:e+"AnimationName"}};return{create:function(e){if(null==n&&i(),null==t[e.id]){for(var r=document.styleSheets[0].insertRule(n.keyframes+" "+e.id+" {}",0),o=document.styleSheets[0].cssRules[r],s=e.frames-(e.frameStart||0),a=100/s,l=e.property||"background-position-x",u=0;s>u;u++){var f=a*(u+1)+"% { "+l+": "+-e.frameWidth*(u+(e.frameStart||0))+"px}";o.insertRule(f)}o.iterationCount=e.iterationCount,o.frameToStop=e.frameToStop,t[e.id]=o}},start:function(i,e,r){var o=i.style;o[n.AnimationName]="none",setTimeout(function(){var s=t[e];return"forwards"===o[n.AnimationFillMode]?(m.stop(i),void 0):(i.addEventListener(n+"AnimationEnd",function(){var t;if(s.frameToStop){var n=s.cssRules[s.cssRules.length-1].style;t={};for(var e=0;n.length>e;e++)t[n[e]]=n[n[e]]}m.stop(i,t)},!1),o[n.AnimationIterationCount]=s.iterationCount||1,o[n.AnimationDuration]=s.cssRules.length*r+"ms",o[n.AnimationTimingFunction]="step-start",o[n.AnimationFillMode]=s.frameToStop?"forwards":"none",o[n.AnimationName]=e,void 0)},0)},stop:function(t,i){var e=t.style;e[n.AnimationFillMode]="none",e[n.AnimationName]="",null!=i&&$(t).css(i)}}}();return function(){function i(t){if(null==t)return null;if(t instanceof Array){if(1===t.length)return i(t[0]);for(var o,s=t,a=r(s),l=new a,u=0,f=s.length;f>u;u++)o=s[u],a!==Array?a===Object&&(l[e(o)]=i(o.nodes)):l.push(i(o));return l}if(n.Dom.TEXTNODE===t.type)return t.content;if(n.Dom.FRAGMENT===t.type)return i(t.nodes);if(n.Dom.NODE){var m={};return m[e(t)]=i(t.nodes),m}return null}function e(t){var n=t.tagName;return 64===n.charCodeAt(0)?n.substring(1):n}function r(t){for(var i,e={},r=0,o=t.length;o>r;r++)switch(i=t[r],i.type){case n.Dom.TEXTNODE:case n.Dom.FRAGMENT:return Array;case n.Dom.NODE:if(1===e[i.tagName])return Array;e[i.tagName]=1}return Object}function o(){}var s=t.Compo;return null==s?(console.warn("To use :animation component, Compo should be defined"),void 0):(o.prototype={constructor:o,render:function(t,n,e){if(null==this.nodes)return console.warn("No Animation Model"),void 0;var r,o,a,l=this.attr["x-slots"];if(null!=l)for(l=l.split(";"),this.slots={},r=0,o=l.length;o>r;r++)a=l[r].trim(),this.slots[a]=this.start;var u,m,h=this.attr["x-pipes"];if(null!=h){for(h=h.split(";"),this.pipes={},r=0,o=h.length;o>r;r++)a=h[r].trim(),u=a.indexOf("."),-1!==u?(m=a.substring(0,u),(this.pipes[m]||(this.pipes[m]={}))[a.substring(++u)]=this.start):console.error(":animation - pipeName.slotName : dot not found");s.pipe.addController(this)}this.model=new f(i(this.nodes)),this.container=e},start:function(t,n){this.model.start(n||this.container,t)}},n.registerHandler(":animation",o),s.prototype.animate=function(t,n,i){var e=this.find("#"+t);return null==e?(console.warn("Animation is not found",t),n&&n(),void 0):(e.start(n,i),void 0)},void 0)}(),function(){function t(){}n.registerHandler(":animation:sprite",t),t.prototype={constructor:t,render:function(t,n,i){var e=this.attr,r=e.src,o=e.id,s=e.frames,a=e.property,l=e.frameWidth,u=e.frameHeight,f=e.iterationCount,h=e.msperframe,d=e.delay,c=(i.getAttribute("style")||"")+";background: url("+r+") 0 0 no-repeat; width:"+l+"px; height:"+u+"px;";i.setAttribute("style",c),m.create({id:o,frameWidth:l,frames:s,property:a,iterationCount:f,delay:d}),e.autostart&&m.start(i,o,h)}}}(),{animate:function(t,n,i){new f(n).start(t,i)},sprite:m}});