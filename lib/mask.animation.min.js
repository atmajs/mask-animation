(function(t,n){"use strict";null==t&&"undefined"!=typeof global&&(t=global);var i=function(){return n(t,mask)};if("object"==typeof exports)module.exports=i();else if("function"==typeof define&&define.amd)define(i);else{var e=i();for(var o in e)t.mask[o]=e[o]}})(this,function(t,n){"use strict";var i=document.createElement("div"),e=function(){return"transform"in i.style?"":"webkitTransform"in i.style?"webkit":"MozTransform"in i.style?"Moz":"OTransform"in i.style?"O":"msTransform"in i.style?"ms":""}(),o=e?"-"+e.toLowerCase()+"-":"",r=function(){var t=document.createElement("div"),n={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},i=null;for(var e in n)if(void 0!==t.style[e]){i=n[e];break}return r=function(){return i},t=null,n=null,r()},s={prop:o+"transition-property",duration:o+"transition-duration",timing:o+"transition-timing-function",delay:o+"transition-delay"},a=function(){function t(t){var n=null;for(e.lastIndex=0;;){var i=e.exec(t);if(!i)return n;(n||(n={}))[i[1]]=i[0]}}function n(t){for(var n=Object.keys(t).sort().reverse(),i=0;n.length>i;i++)n[i]=t[n[i]];return n.join(" ")}function i(){this.transforms={}}var e=/([\w]+)\([^\)]+\)/g;return i.prototype={constructor:i,handle:function(i){var e=t(i.from),o=t(i.to),r=null;if(e){for(r in this.transforms)r in e==!1&&(e[r]=this.transforms[r]);i.from=n(e);for(r in e)this.transforms[r]=e[r]}for(r in this.transforms)r in o==!1&&(o[r]=this.transforms[r]);i.to=n(o);for(r in o)this.transforms[r]=o[r]}},i}(),l=function(){function t(t){var n=t.split(/ *\| */g),e={},r=n.length;e.prop=n[0]in i?o+n[0]:n[0];var s=n[1].split(/ *> */);if(s[0]&&(e.from=s[0]),e.to=s[s.length-1],r>2){var a=/(\d+m?s)?\s*([a-z]+[^\s]*)?\s*(\d+m?s)?/.exec(n[2]);if(null!=a)return e.duration=a[1]||"200ms",e.timing=a[2]||"linear",e.delay=a[3]||"0",e}return e.duration="200ms",e.timing="linear",e.delay="0",e}function n(i,e){this.parent=e,this.transformModel=e&&e.transformModel||new a;var o=i.model||i;if(o instanceof Array){this.model=[];for(var r=0,s=o.length;s>r;r++)this.model.push(new n(o[r],this))}else if(o instanceof Object){if(o===i)return console.error('Animation Object Model has no "model" property',i),this.modelCount=this.nextCount=this.state=0,void 0;this.model=[new n(o,this)]}else"string"==typeof o&&(this.model=t(o),~this.model.prop.indexOf("transform")&&this.transformModel.handle(this.model));null!=i.next&&(this.next=new n(i.next,this)),this.state=0,this.modelCount=this.model instanceof Array?this.model.length:1,this.nextCount=0,null!=this.next&&(this.nextCount=this.next instanceof Array?this.next.length:1)}var i={transform:null};return n.prototype={constructor:n,reset:function(){this.state=0,this.modelCount=this.model instanceof Array?this.model.length:1,this.nextCount=0,null!=this.next&&(this.nextCount=this.next instanceof Array?this.next.length:1);for(var t=this.model instanceof Array,n=t?this.model.length:1,i=null,e=0;t?n>e:1>e;e++)i=t?this.model[e]:this.model,i.reset&&i.reset()},getNext:function(){return 0===this.state?(this.state=1,this):(1===this.state&&this.modelCount>0&&--this.modelCount,1===this.state&&0===this.modelCount&&(this.state=2,this.next)?this.next:(2===this.state&&this.nextCount>0&&--this.nextCount,2===this.state&&0===this.nextCount&&this.parent?this.parent.getNext&&this.parent.getNext():null))}},n}(),u=function(){function t(){this.arr=[]}return t.prototype={constructor:t,put:function(t){if(null==t)return!1;var n,i,e=t.getNext(),o=!1;if(null==e)return!1;if(e instanceof Array){for(i=0,n=e.length;n>i;i++)this.put(e[i])===!0&&(o=!0);return o}if(0===e.state&&(e.state=1),e.model instanceof Array){for(o=!1,i=0,n=e.model.length;n>i;i++)this.put(e.model[i])===!0&&(o=!0);return o}return this.resolve(e.model.prop),this.arr.push(e),!0},resolve:function(t){for(var n,i=0,e=this.arr.length;e>i;i++)if(n=this.arr[i],n.model.prop===t)return this.arr.splice(i,1),this.put(n);return!1},getCss:function(t,n){var i,e,o,r;for(i=0,e=this.arr.length;e>i;i++){r=this.arr[i],"from"in r.model&&(t[r.model.prop]=r.model.from),n[r.model.prop]=r.model.to;for(o in s)(n[s[o]]||(n[s[o]]=[])).push(r.model[o])}for(o in s)n[s[o]]=n[s[o]].join(",")},clear:function(){this.arr=[]}},t}(),f=function(){function t(t){this.stack=new u,this.model=new l(t),this.transitionEnd=this.transitionEnd.bind(this)}var n=window.WebKitTransitionEvent||window.mozTransitionEvent||window.oTransitionEvent||window.TransitionEvent,i={display:1,"font-family":1,visibility:1};return t.prototype={constructor:t,start:function(t,n){this.onComplete=n;var i={},e={};this.model.reset(),this.stack.clear(),this.stack.put(this.model),this.stack.getCss(i,e),t.addEventListener(r(),this.transitionEnd,!1),this.element=t,this.apply(i,e)},transitionEnd:function(t){if(this.stack.resolve(t.propertyName)===!0){var n={},i={};this.stack.getCss(n,i),this.apply(n,i)}else 1>this.stack.arr.length&&(this.element.removeEventListener(r(),this.transitionEnd,!1),this.onComplete&&this.onComplete())},apply:function(t,e){t[o+"transition"]="none";var s=this.element.style,a=this.element;if(null!=t)for(var l in t)s.setProperty(l,t[l],"");setTimeout(function(){var t;for(var o in e)s.setProperty(o,e[o],""),i.hasOwnProperty(o)&&(t||(t=[])).push(o);if(null!=t&&null!=n)for(var l=r(),u=0;t.length>u;u++){var f=new n(l,{propertyName:t[u],bubbles:!0,cancelable:!0});a.dispatchEvent(f)}},0)}},t}(),m=function(){var t={},n=null,i=function(){n={keyframes:"@"+o+"keyframes",AnimationIterationCount:o+"AnimationIterationCount",AnimationDuration:o+"AnimationDuration",AnimationTimingFunction:o+"AnimationTimingFunction",AnimationFillMode:o+"AnimationFillMode",AnimationName:o+"AnimationName"}};return{create:function(e){if(null==n&&i(),null==t[e.id]){for(var o=document.styleSheets[0].insertRule(n.keyframes+" "+e.id+" {}",0),r=document.styleSheets[0].cssRules[o],s=e.frames-(e.frameStart||0),a=0|100/s,l=e.property||"background-position-x",u=0;s>u;u++){var f=a*(u+1)+"% { "+l+": "+-e.frameWidth*(u+(e.frameStart||0))+"px}";r.insertRule(f)}r.iterationCount=e.iterationCount,r.frameToStop=e.frameToStop,t[e.id]=r}},start:function(i,e,o){var r=i.get(0).style;r[n.AnimationName]="none",setTimeout(function(){var s=t[e];return"forwards"===r[n.AnimationFillMode]?(m.stop(i),void 0):(i.on(n+"AnimationEnd",function(){var t;if(s.frameToStop){var n=s.cssRules[s.cssRules.length-1].style;t={};for(var e=0;n.length>e;e++)t[n[e]]=n[n[e]]}m.stop(i,t)}),r[n.AnimationIterationCount]=s.iterationCount||1,r[n.AnimationDuration]=s.cssRules.length*o+"ms",r[n.AnimationTimingFunction]="step-start",r[n.AnimationFillMode]=s.frameToStop?"forwards":"none",r[n.AnimationName]=e,void 0)},0)},stop:function(t,i){var e=t.get(0).style;e[n.AnimationFillMode]="none",e[n.AnimationName]="",null!=i&&t.css(i)}}}();return function(){function i(t){if(null==t)return null;if(t instanceof Array){if(1===t.length)return i(t[0]);for(var r,s=t,a=o(s),l=new a,u=0,f=s.length;f>u;u++)r=s[u],a!==Array?a===Object&&(l[e(r)]=i(r.nodes)):l.push(i(r));return l}if(n.Dom.TEXTNODE===t.type)return t.content;if(n.Dom.FRAGMENT===t.type)return i(t.nodes);if(n.Dom.NODE){var m={};return m[e(t)]=i(t.nodes),m}return null}function e(t){var n=t.tagName;return 64===n.charCodeAt(0)?n.substring(1):n}function o(t){for(var i,e={},o=0,r=t.length;r>o;o++)switch(i=t[o],i.type){case n.Dom.TEXTNODE:case n.Dom.FRAGMENT:return Array;case n.Dom.NODE:if(1===e[i.tagName])return Array;e[i.tagName]=1}return Object}function r(){}var s=t.Compo;return null==s?(console.warn("To use :animation component, Compo should be defined"),void 0):(r.prototype={constructor:r,render:function(t,n,e){if(null==this.nodes)return console.warn("No Animation Model"),void 0;var o,r,a,l=this.attr["x-slots"];if(null!=l)for(l=l.split(";"),this.slots={},o=0,r=l.length;r>o;o++)a=l[o].trim(),this.slots[a]=this.start;var u,m,h=this.attr["x-pipes"];if(null!=h){for(h=h.split(";"),this.pipes={},o=0,r=h.length;r>o;o++)a=h[o].trim(),u=a.indexOf("."),-1!==u?(m=a.substring(0,u),(this.pipes[m]||(this.pipes[m]={}))[a.substring(++u)]=this.start):console.error(":animation - pipeName.slotName : dot not found");s.pipe.addController(this)}this.model=new f(i(this.nodes)),this.container=e},start:function(t,n){this.model.start(n||this.container,t)}},n.registerHandler(":animation",r),s.prototype.animate=function(t,n,i){var e=this.find("#"+t);return null==e?(console.warn("Animation is not found",t),n&&n(),void 0):(e.start(n,i),void 0)},void 0)}(),{animate:function(t,n,i){new f(n).start(t,i)}}});